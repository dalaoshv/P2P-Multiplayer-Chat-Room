import{u as $,a as b,c as B,_ as I}from"./p2p-63ad1270.js";import{d as C,r as L,c as k,a as o,b as t,w as V,v as z,e as H,u as g,n as x,f as v,g as m,h as S,o as c,p as M,i as N,_ as P,j as T,k as D,F as K,l as R,t as y,m as U,q as j}from"./index-557e2898.js";const F=r=>(M("data-v-d1fb4c39"),r=r(),N(),r),q={class:"send-bar"},E={class:"msg-edit"},G=["onKeydown","disabled"],A=F(()=>t("div",{class:"divider"},null,-1)),J={key:0,class:"tips"},O={key:1,class:"tips"},Q={key:2,class:"tips"},W={key:3,class:"tips"},X=C({__name:"index",props:{username:{}},setup(r){const s=r,e=L(""),l=$(),{loginState:n}=b(),_=k(()=>{var i;return!(n.hasLogin&&((i=l.chatlogs[s.username||"@"])!=null&&i.length))}),u=k(()=>s.username?l.permits[s.username]||0:2),h=()=>{var i;(i=e.value)!=null&&i.trim().length&&(l.sendP2PMsg(s.username,e.value),e.value="")},d=()=>{_.value||(l.chatlogs[s.username||"@"]=[])},p=i=>{const a=B.get(s.username);a.open?a.send(i):a.once("open",()=>{a.send(i)}),i.event=="auth"&&(l.permits[s.username]=2)};return(i,a)=>{const w=I;return c(),o("div",q,[t("div",E,[V(t("input",{"onUpdate:modelValue":a[0]||(a[0]=f=>e.value=f),class:"msg-input",placeholder:"来聊点什么吧~",onKeydown:H(h,["enter"]),disabled:!g(n).hasLogin||u.value!==2,autofocus:""},null,40,G),[[z,e.value]]),t("div",{onClick:d,class:x(["action",{disabled:_.value}])},[v(w,{class:"send",icon:"shanchu",size:20})],2),A,t("div",{onClick:h,class:x(["action",{disabled:!e.value.length}])},[v(w,{class:"send",icon:"huojian",size:20})],2)]),g(n).ready?g(n).hasLogin?u.value===0?(c(),o("span",Q,[m(" 点击 "),t("span",{class:"tips-text",onClick:a[2]||(a[2]=f=>p({event:"call",data:null}))},"请求"),m(" 聊天通话 ")])):u.value===1?(c(),o("span",W,[m(" 点击 "),t("span",{class:"tips-text",onClick:a[3]||(a[3]=f=>p({event:"auth",data:"agree"}))},"同意"),m(" 聊天请求 ")])):S("",!0):(c(),o("span",O,[m(" 请先点击 "),t("span",{class:"tips-text",onClick:a[1]||(a[1]=f=>g(n).showLogin=!0)},"登录"),m(" 之后再发言~ ")])):(c(),o("span",J," 正在初始化连接中，请稍后... "))])}}});const Y=P(X,[["__scopeId","data-v-d1fb4c39"]]),Z={class:"chat-msg-list"},ss={key:0,class:"tips-block"},es={key:1,class:"msg-wrap"},ts={class:"username"},ns={class:"content-wrap"},as={class:"text"},os=C({__name:"index",props:{username:{}},setup(r){const s=r,e=L(),l=$(),{loginState:n}=b(),_=k(()=>n.hasLogin?l.chatlogs[s.username||"@"]:[]);return T(()=>{D(()=>{e.value.scrollTo({top:e.value.scrollHeight-e.value.clientHeight,behavior:"smooth"})})}),(u,h)=>(c(),o("div",Z,[t("div",{class:"scroll-list",ref_key:"el",ref:e},[(c(!0),o(K,null,R(_.value,(d,p)=>(c(),o("div",{class:x(["chat-item",{"is-me":d.type==="me"}]),key:p},[d.type==="it"?(c(),o("span",ss,y(d.content),1)):(c(),o("div",es,[t("div",ts,y(d.username),1),t("div",ns,[t("div",as,y(d.content),1)])]))],2))),128))],512)]))}});const cs=P(os,[["__scopeId","data-v-f8f330e9"]]),is={class:"chat-box"},ls={class:"room-name"},rs={class:"name"},us=C({__name:"index",setup(r){const s=U(),e=b(),l=$(),n=k(()=>e.username&&e.username!==s.params.id&&s.params.id&&l.online.has(s.params.id)?s.params.id:""),_=j(),u=()=>{n.value&&_.push({path:"/"})};return(h,d)=>{const p=I;return c(),o("div",is,[t("div",ls,[t("span",rs,y(n.value||"公共聊天室"),1),n.value?(c(),o("span",{key:0,class:"setting",onClick:u},[v(p,{class:"send",icon:"yichu",size:20})])):S("",!0)]),v(cs,{username:n.value},null,8,["username"]),v(Y,{username:n.value},null,8,["username"])])}}});export{us as default};
