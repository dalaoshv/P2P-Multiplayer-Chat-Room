import{u as C,a as $,c as S,_ as w}from"./p2p-09889b9d.js";import{d as I,r as B,c as g,a as i,b as t,w as V,v as z,e as L,u as h,n as x,f as p,g as d,h as P,o as l,p as M,i as N,_ as D,j as K,k as R,t as j}from"./index-9c3b04fb.js";const H=r=>(M("data-v-d1fb4c39"),r=r(),N(),r),T={class:"send-bar"},U={class:"msg-edit"},E=["onKeydown","disabled"],G=H(()=>t("div",{class:"divider"},null,-1)),q={key:0,class:"tips"},A={key:1,class:"tips"},F={key:2,class:"tips"},J={key:3,class:"tips"},O=I({__name:"index",props:{username:{}},setup(r){const e=r,o=B(""),c=C(),{loginState:n}=$(),_=g(()=>{var a;return!(n.hasLogin&&((a=c.chatlogs[e.username||"@"])!=null&&a.length))}),u=g(()=>e.username?c.permits[e.username]||0:2),f=()=>{var a;(a=o.value)!=null&&a.trim().length&&(c.sendP2PMsg(e.username,o.value),o.value="")},y=()=>{_.value||(c.chatlogs[e.username||"@"]=[])},m=a=>{const s=S.get(e.username);s.open?s.send(a):s.once("open",()=>{s.send(a)}),a.event=="auth"&&(c.permits[e.username]=2)};return(a,s)=>{const k=w;return l(),i("div",T,[t("div",U,[V(t("input",{"onUpdate:modelValue":s[0]||(s[0]=v=>o.value=v),class:"msg-input",placeholder:"来聊点什么吧~",onKeydown:L(f,["enter"]),disabled:!h(n).hasLogin||u.value!==2,autofocus:""},null,40,E),[[z,o.value]]),t("div",{onClick:y,class:x(["action",{disabled:_.value}])},[p(k,{class:"send",icon:"shanchu",size:20})],2),G,t("div",{onClick:f,class:x(["action",{disabled:!o.value.length}])},[p(k,{class:"send",icon:"huojian",size:20})],2)]),h(n).ready?h(n).hasLogin?u.value===0?(l(),i("span",F,[d(" 点击 "),t("span",{class:"tips-text",onClick:s[2]||(s[2]=v=>m({event:"call",data:null}))},"请求"),d(" 聊天通话 ")])):u.value===1?(l(),i("span",J,[d(" 点击 "),t("span",{class:"tips-text",onClick:s[3]||(s[3]=v=>m({event:"auth",data:"agree"}))},"同意"),d(" 聊天请求 ")])):P("",!0):(l(),i("span",A,[d(" 请先点击 "),t("span",{class:"tips-text",onClick:s[1]||(s[1]=v=>h(n).showLogin=!0)},"登录"),d(" 之后再发言~ ")])):(l(),i("span",q," 正在初始化连接中，请稍后... "))])}}});const b=D(O,[["__scopeId","data-v-d1fb4c39"]]),Q={class:"chat-box"},W={class:"room-name"},X={class:"name"},ss=I({__name:"index",setup(r){const e=K(),o=$(),c=C(),n=g(()=>o.username&&o.username!==e.params.id&&e.params.id&&c.online.has(e.params.id)?e.params.id:""),_=R(),u=()=>{n.value&&_.push({path:"/"})};return(f,y)=>{const m=w;return l(),i("div",Q,[t("div",W,[t("span",X,j(n.value||"公共聊天室"),1),n.value?(l(),i("span",{key:0,class:"setting",onClick:u},[p(m,{class:"send",icon:"yichu",size:20})])):P("",!0)]),p(b,{username:n.value},null,8,["username"]),p(b,{username:n.value},null,8,["username"])])}}});export{ss as default};
